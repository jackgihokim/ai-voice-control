# Voice Control for AI Apps - Product Requirements Document

## 1. 프로젝트 개요

### 1.1 제품명
**Voice Control for AI Apps** (가칭)

### 1.2 제품 설명
macOS 환경에서 음성 명령을 통해 다양한 AI 데스크톱 애플리케이션과 터미널 기반 도구를 통합 제어하는 네이티브 애플리케이션

### 1.3 목표 사용자
- AI 도구를 자주 사용하는 개발자 및 전문가
- 여러 AI 애플리케이션을 동시에 활용하는 사용자
- 핸즈프리 작업 환경을 선호하는 사용자

### 1.4 핵심 가치
- **통합성**: 여러 AI 도구를 하나의 인터페이스로 제어
- **효율성**: 음성 명령으로 빠른 앱 전환 및 입력
- **접근성**: 키보드 없이도 AI 도구 활용 가능

## 2. 기술 사양

### 2.1 플랫폼
- **타겟 OS**: macOS 15.0 이상
- **개발 언어**: Swift 6.1 이상
- **UI 프레임워크**: SwiftUI

### 2.2 핵심 기술 스택
- **음성 인식**: Apple Speech Framework
- **음성 합성**: AVSpeechSynthesizer (시스템 음성 활용)
- **노이즈 제거**: Voice Isolation API (macOS 12+)
- **앱 제어**: Accessibility API
- **터미널 제어**: iTerm2 AppleScript API
- **자동 프롬프트**: JSON 응답 형식 요청 자동 추가

### 2.3 앱 아키텍처
- **앱 타입**: Menu Bar 애플리케이션
- **백그라운드 실행**: 지원
- **샌드박스**: 비활성화 (Accessibility API 사용을 위해)

## 3. 기능 요구사항

### 3.1 메뉴바 기능

#### 3.1.1 앱 관리
- **앱 등록**
  - 지원 앱 목록에서 선택 또는 수동 추가
  - 각 앱별 별칭 설정 (한국어/영어)
  - 웨이크 워드 설정 (복수 등록 가능, 중복 방지)
  - End 워드 설정 (복수 등록 가능)
  - 앱 실행 경로 자동 감지
- **앱 삭제**
  - 등록된 앱 목록에서 선택하여 삭제
  - 삭제 확인 다이얼로그
- **앱 설정**
  - 각 앱별 음성 프로필 선택
  - 웨이크 워드 인식 시 응답 메시지 커스터마이징
  - 파형 UI 색상 테마 설정 (앱별)

#### 3.1.2 음성 설정
- **음성 프로필 관리**
  - 시스템 음성 목록 표시
  - 각 앱별 음성 할당
  - 음성 속도 및 음량 조절
- **음성 다운로드 안내**
  - 고품질 음성 미설치 시 다운로드 안내
  - 시스템 설정으로 직접 연결 버튼

#### 3.1.3 일반 설정
- **음성 인식 설정**
  - Voice Isolation 활성화/비활성화
  - 민감도 조절
- **프롬프트 설정**
  - JSON 형식 응답 요청 프롬프트 표시/숨김
  - 프롬프트 템플릿: 
    ```
    답변을 다음 형식으로 해주세요.
    1. {'summary': '답변 요약'} (JSON 형식)
    2. 전체 상세 답변
    ```

### 3.2 음성 인식 기능

#### 3.2.1 기본 동작
- **항상 듣기 모드**
  - 백그라운드에서 지속적으로 웨이크 워드 감지
  - 웨이크 워드 인식 시 해당 앱 활성화
  - Voice Isolation API를 통한 실시간 노이즈 제거
- **언어 지원**
  - 한국어, 영어 실시간 인식
  - 자동 언어 감지

#### 3.2.2 명령어 체계
- **웨이크 워드**: 앱별로 설정된 단어로 앱 활성화
- **텍스트 입력**: 웨이크 워드 후 자유 발화
- **End 워드**: 설정된 종료 단어로 입력 완료 및 전송
- **취소**: "취소" / "Cancel" 로 현재 입력 취소

### 3.3 앱 제어 기능

#### 3.3.1 데스크톱 앱 제어
- **지원 앱**
  - Claude Desktop
  - ChatGPT Desktop
  - Perplexity
  - 기타 텍스트 입력 가능한 앱
- **제어 동작**
  - 앱 활성화 (포커스 이동)
  - 텍스트 입력 필드 자동 감지
  - JSON 형식 프롬프트 자동 추가
  - 음성 인식 텍스트 입력
  - End 워드 감지 시 Enter 키 전송

#### 3.3.2 터미널 제어
- **지원 터미널**
  - iTerm2 (AppleScript API 활용)
    - 세션 관리
    - 명령어 실행
    - 출력 캡처
  - Terminal.app (기본 지원)
- **지원 CLI 도구**
  - Claude Code
  - Gemini CLI
  - 기타 대화형 CLI 도구
- **제어 동작**
  - 터미널 창/세션 활성화
  - JSON 형식 프롬프트 자동 추가
  - 명령어 입력
  - 실행 결과 캡처

### 3.4 응답 처리 기능

#### 3.4.1 응답 감지
- **JSON 응답 파싱**
  - 응답에서 JSON 형식 감지
  - 'summary' 필드 추출
- **응답 완료 판단**
  - JSON 블록 종료 감지
  - 일정 시간 동안 텍스트 변화 없음

#### 3.4.2 음성 출력
- **TTS 처리**
  - JSON의 'summary' 내용만 음성 출력
  - 앱별 설정된 음성으로 출력
  - 문장 단위 스트리밍 출력
- **출력 제어**
  - 일시정지/재개
  - 건너뛰기
  - 음량 조절

### 3.5 UI 요구사항

#### 3.5.1 메뉴바 아이콘
- **상태 표시**
  - 대기 중: 기본 아이콘
  - 웨이크 워드 대기 중: 작은 점 애니메이션
  - 음성 인식 중: 파형 애니메이션
  - 오류 발생: 경고 아이콘
- **메뉴 구조**
  - 빠른 앱 전환 메뉴
  - 현재 활성 앱 표시
  - 설정 메뉴

#### 3.5.2 파형 UI
- **위치**: 화면 우측 상단 고정
- **크기**: 200x60 픽셀 (기본값)
- **디자인**
  - 반투명 배경
  - 실시간 음성 레벨에 따른 파형 애니메이션
  - 웨이크 워드 인식 시 앱별 색상으로 변경
  - 현재 활성 앱 아이콘 표시
- **인터랙션**
  - 클릭 시 음성 출력 일시정지/재개
  - 우클릭 시 빠른 설정 메뉴

#### 3.5.3 설정 창
- **창 크기**: 700x500 픽셀
- **탭 구조**
  - 앱 관리
    - 앱 추가/삭제
    - 웨이크 워드 설정
    - End 워드 설정
    - 응답 메시지 설정
  - 음성 설정
    - 시스템 음성 선택
    - 음성 다운로드 안내
  - 일반 설정
    - Voice Isolation 토글
    - JSON 프롬프트 토글
  - 정보
- **디자인 가이드라인**
  - macOS 네이티브 UI 컴포넌트 사용
  - 다크 모드 지원

#### 3.5.4 음성 피드백
- **웨이크 워드 인식 시**
  - 앱별 설정된 응답 음성 출력 (기본: "네")
  - 파형 UI 색상 변경
  - 앱 아이콘 표시

## 4. 비기능 요구사항

### 4.1 성능
- **웨이크 워드 인식**: 최대 300ms
- **음성 인식 지연**: 최대 500ms
- **앱 전환 시간**: 최대 200ms
- **메모리 사용량**: 최대 250MB (항상 듣기 모드)
- **CPU 사용률**: 대기 시 3-5% (Voice Isolation 포함)

### 4.2 보안 및 권한
- **필수 권한**
  - 마이크 접근 권한
  - 접근성 권한
  - 자동화 권한 (AppleScript)
- **데이터 보안**
  - 음성 데이터 로컬 처리
  - 대화 내용 저장 안 함

### 4.3 호환성
- **macOS 버전**: 15.0 이상 (Voice Isolation은 12.0+)
- **프로세서**: Apple Silicon, Intel 지원
- **언어**: 한국어, 영어 UI 지원

### 4.4 접근성
- **VoiceOver 지원**
- **키보드 네비게이션**
- **고대비 모드 지원**

## 5. 워크플로우 예시

### 5.1 기본 사용 시나리오
1. 사용자: "클로드" (웨이크 워드)
2. 앱: "네, 무엇을 도와드릴까요?" (음성 응답) + 파형 UI 색상 변경
3. 사용자: "파이썬으로 퀵소트 알고리즘 구현해줘. 오버." (End 워드)
4. 앱: JSON 프롬프트 자동 추가 후 Claude Desktop에 입력 전송
5. Claude Desktop: JSON 형식 포함 응답 생성
6. 앱: JSON에서 summary 추출하여 음성 출력

### 5.2 앱 전환 시나리오
1. 사용자: "지피티" (다른 웨이크 워드)
2. 앱: "말씀하세요" (ChatGPT용 응답) + 파형 UI 색상 변경
3. 사용자: "방금 답변 더 자세히 설명해줘. 끝." (End 워드)
4. 앱: ChatGPT Desktop으로 전환 후 입력

## 6. 제한사항 및 가정

### 6.1 제한사항
- 오프라인 음성 인식만 지원 (Speech Framework 한계)
- 웹 기반 AI 서비스는 미지원
- Voice Isolation은 macOS 12 이상에서만 지원
- End 워드 없이는 입력 전송 불가

### 6.2 가정
- 사용자가 제어하려는 앱이 이미 설치되어 있음
- 사용자가 필요한 시스템 권한을 부여함
- 웨이크 워드와 End 워드가 명확히 구분 가능함

## 7. 향후 확장 계획

### 7.1 단기 (v1.1)
- 대화 히스토리 기능
- 커스텀 명령어 매크로
- 더 많은 앱 지원

### 7.2 중기 (v2.0)
- 웹 브라우저 내 AI 서비스 제어
- 침묵 감지를 통한 자동 전송 옵션
- 멀티 모달 입력 (음성 + 제스처)

### 7.3 장기 (v3.0)
- 플러그인 시스템
- 다중 사용자 프로필
- iOS/iPadOS 연동

## 8. 성공 지표

### 8.1 기술적 지표
- 웨이크 워드 인식 정확도: 95% 이상
- 음성 인식 정확도: 90% 이상
- 앱 제어 성공률: 95% 이상
- 크래시 발생률: 0.1% 미만

### 8.2 사용자 경험 지표
- 앱 전환 시간 단축: 기존 대비 50%
- 일일 활성 사용 시간: 30분 이상
- 사용자 만족도: 4.0/5.0 이상

## 9. 개발 단계

### Phase 1: 핵심 기능 (4주)
- 메뉴바 앱 기본 구조
- 음성 인식 엔진 통합
- 웨이크 워드/End 워드 시스템
- 기본 앱 제어 (Claude Desktop)

### Phase 2: 앱 확장 (3주)
- 다중 앱 지원
- iTerm2 통합
- Voice Isolation 적용
- JSON 프롬프트 시스템

### Phase 3: 고급 기능 (3주)
- JSON 응답 파싱
- 파형 UI 구현
- 앱별 음성 설정
- 시스템 음성 다운로드 안내

### Phase 4: 마무리 (2주)
- 성능 최적화
- 버그 수정
- 사용자 가이드 작성